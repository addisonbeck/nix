#+TITLE: Bitwarden Configuration
#+PROPERTY: header-args:emacs-lisp :tangle bitwarden.el :results none

* Clients
** Installing Npm Deps

#+begin_src emacs-lisp
(defcustom bitwarden-clients-npm-i-command "npm i"
  "Commands to run to install npm dependencies in a Bitwarden clients project "
  :type 'string
  :group 'tools)

(defun bitwarden/clients-npm-i ()
  "Select a project with Projectile and run `bitwarden-clients-npm-i-command` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-npm-i-command))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: npm i" . bitwarden/clients-npm-i))
#+end_src

** Typechecking

#+begin_src emacs-lisp
(defcustom bitwarden-clients-test-types-command "npm run test:types"
  "Command to run type tests in Bitwarden clients projects."
  :type 'string
  :group 'tools)

(defun bitwarden/clients-run-test-types ()
  "Select a project with Projectile and run `bitwarden-clients-test-types-command` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-test-types-command))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: typechecker" . bitwarden/clients-run-test-types))
#+end_src

** Building The Cli
*** With Nx
#+begin_src emacs-lisp
(defcustom bitwarden-clients-nx-bit-build-cli "npx nx build cli --configuration=bit-dev --outputStyle=stream"
  "Command to build the Bitwarden CLI locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-nx-bit-build-cli
      "npx nx build cli --configuration=bit-dev --outputStyle=stream")

(defun bitwarden/cli-nx-build-bit ()
  "Select a project with Projectile and run `bitwarden-clients-nx-bit-build-cli` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-nx-bit-build-cli))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx bit build cli" . bitwarden/cli-nx-build-bit))
#+end_src

*** Classic
#+begin_src emacs-lisp
(defcustom bitwarden-clients-classic-bit-build-cli "cd apps/cli && npm run build:bit"
  "Command to build the Bitwaren CLI locally with npm"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-classic-bit-build-cli
      "cd apps/cli && npm run build:bit")

(defun bitwarden/cli-classic-build-bit ()
  "Select a project with Projectile and run `bitwarden-clients-classic-bit-build-cli` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-classic-bit-build-cli))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: classic bit build cli" . bitwarden/cli-classic-build-bit))
#+end_src

#+RESULTS:
: ((bitwarden/clients: classic bit build cli . bitwarden/cli-classic-build-bit) (bitwarden/clients: npm ci . bitwarden/clients-npm-ci) (bitwarden/clients: nx bit build cli . bitwarden/cli-nx-build-bit) (bitwarden/clients: npm ci . bitwarden/cli-npm-ci) (bitwarden/clients: typechecker . bitwarden/clients-run-test-types) (nix: update flake . my/nix/flake-update) (nix: format . my/nix/format) (nix: rebuild . my/nix/rebuild))

** Building Web 
*** With Nx
#+begin_src emacs-lisp
(defcustom bitwarden-clients-nx-bit-build-web "npx nx build web --configuration=bit-dev --outputStyle=stream"
  "Command to build the Bitwarden WEB locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-nx-bit-build-web
      "npx nx build web --configuration=bit-dev --outputStyle=stream")

(defun bitwarden/web-nx-build-bit ()
  "Select a project with Projectile and run `bitwarden-clients-nx-bit-build-web` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-nx-bit-build-web))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx bit build web" . bitwarden/web-nx-build-bit))
#+end_src

*** Classic
#+begin_src emacs-lisp
(defcustom bitwarden-clients-classic-bit-build-web "cd apps/web && npm run build:bit"
  "Command to build the Bitwaren web locally with npm"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-classic-bit-build-web
      "cd apps/web && npm run build:bit")

(defun bitwarden/web-classic-build-bit ()
  "Select a project with Projectile and run `bitwarden-clients-classic-bit-build-web` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-classic-bit-build-web))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: classic bit build web" . bitwarden/web-classic-build-bit))
#+end_src

** Serving Web 

#+begin_src emacs-lisp
(defcustom bitwarden-clients-serve-web-commercial "npx nx serve web --configuration=commercial-dev"
  "Command to build the Bitwarden WEB locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-serve-web-web-commercial
      "npx nx serve web --configuration=commercial-dev")

(defun bitwarden/serve-web-commercial ()
  "Select a project with Projectile and run `bitwarden-clients-serve-web-commercial` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-serve-web-commercial))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx serve web commercial" . bitwarden/serve-web-commercial))
#+end_src

** Serving Browser

#+begin_src emacs-lisp
(defcustom bitwarden-clients-serve-browser "npx nx serve browser"
  "Command to build the Bitwarden BROWSERR locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-serve-browser
      "npx nx serve browser")

(defun bitwarden/serve-browser ()
  "Select a project with Projectile and run `bitwarden-clients-serve-browser` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-serve-browser))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx serve browser" . bitwarden/serve-browser))
#+end_src

** Testing Browser

#+begin_src emacs-lisp
(defcustom bitwarden-clients-test-browser "npx nx test browser"
  "Command to build the Bitwarden BROWSERR locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-test-browser
      "npx nx test browser")

(defun bitwarden/test-browser ()
  "Select a project with Projectile and run `bitwarden-clients-test-browser` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-test-browser))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx test browser" . bitwarden/test-browser))
#+end_src

** Linting Browser

#+begin_src emacs-lisp
(defcustom bitwarden-clients-lint-browser "npx nx lint browser"
  "Command to build the Bitwarden BROWSERR locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-lint-browser
      "npx nx lint browser")

(defun bitwarden/lint-browser ()
  "Select a project with Projectile and run `bitwarden-clients-lint-browser` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-lint-browser))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx lint browser" . bitwarden/lint-browser))
#+end_src
** Building Browser

#+begin_src emacs-lisp
(defcustom bitwarden-clients-build-browser "npx nx build browser"
  "Command to build the Bitwarden BROWSERR locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-build-browser
      "npx nx build browser")

(defun bitwarden/build-browser ()
  "Select a project with Projectile and run `bitwarden-clients-build-browser` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-browser))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build browser" . bitwarden/build-browser))
#+end_src

* Desktop
** Testing Desktop

#+begin_src emacs-lisp
(defcustom bitwarden-clients-test-desktop "npx nx test desktop"
  "Command to build the Bitwarden DESKTOP locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-test-desktop
      "npx nx test desktop")

(defun bitwarden/test-desktop ()
  "Select a project with Projectile and run `bitwarden-clients-test-desktop` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-test-desktop))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx test desktop" . bitwarden/test-desktop))
#+end_src

** Linting Desktop

#+begin_src emacs-lisp
(defcustom bitwarden-clients-lint-desktop "npx nx lint desktop"
  "Command to build the Bitwarden DESKTOP locally with Nx"
  :type 'string
  :group 'tools)
(setq bitwarden-clients-lint-desktop
      "npx nx lint desktop")

(defun bitwarden/lint-desktop ()
  "Select a project with Projectile and run `bitwarden-clients-lint-desktop` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-lint-desktop))
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx lint desktop" . bitwarden/lint-desktop))
#+end_src

** Build Native

#+begin_src emacs-lisp
(defcustom bitwarden-clients-build-desktop-native "npx nx build-native desktop"
  "Command to build the Bitwarden DESKTOP native module locally with Nx"
  :type 'string
  :group 'tools)

(setq bitwarden-clients-build-desktop-native
      "npx nx build-native desktop")

(defun bitwarden/build-desktop-native ()
  "Select a project with Projectile and run `bitwarden-clients-build-desktop-native` in it."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-desktop-native))

(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build-native desktop" . bitwarden/build-desktp-native))
#+end_src

** Build Webpack

#+begin_src emacs-lisp
;; Individual process build commands
(defcustom bitwarden-clients-build-desktop-main "npx nx run desktop:build-main"
  "Command to build the Bitwarden DESKTOP main process with Nx"
  :type 'string
  :group 'tools)

(defcustom bitwarden-clients-build-desktop-renderer "npx nx run desktop:build-renderer"
  "Command to build the Bitwarden DESKTOP renderer process with Nx"
  :type 'string
  :group 'tools)

(defcustom bitwarden-clients-build-desktop-preload "npx nx run desktop:build-preload"
  "Command to build the Bitwarden DESKTOP preload process with Nx"
  :type 'string
  :group 'tools)

;; Full coordinated build command
(defcustom bitwarden-clients-build-desktop "npx nx build desktop"
  "Command to build all Bitwarden DESKTOP processes with Nx"
  :type 'string
  :group 'tools)

;; Set the variables
(setq bitwarden-clients-build-desktop-main "npx nx run desktop:build-main")
(setq bitwarden-clients-build-desktop-renderer "npx nx run desktop:build-renderer")
(setq bitwarden-clients-build-desktop-preload "npx nx run desktop:build-preload")
(setq bitwarden-clients-build-desktop "npx nx build desktop")

;; Individual process build functions
(defun bitwarden/build-desktop-main ()
  "Build the Bitwarden desktop main process with Nx."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-desktop-main))

(defun bitwarden/build-desktop-renderer ()
  "Build the Bitwarden desktop renderer process with Nx."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-desktop-renderer))

(defun bitwarden/build-desktop-preload ()
  "Build the Bitwarden desktop preload process with Nx."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-desktop-preload))

;; Full build function
(defun bitwarden/build-desktop ()
  "Build all Bitwarden desktop processes with Nx (coordinated build)."
  (interactive)
  (my/projectile-run-command-in-selected-project bitwarden-clients-build-desktop))

;; Add to executer picker candidates
(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build desktop (full)" . bitwarden/build-desktop))

(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build desktop:main" . bitwarden/build-desktop-main))

(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build desktop:renderer" . bitwarden/build-desktop-renderer))

(add-to-list 'my/executer-picker-candidates
             '("bitwarden/clients: nx build desktop:preload" . bitwarden/build-desktop-preload))
#+end_src
